{% if entities %}
  <div class="status-bar" style="background:#d4edda;color:#155724;">
    <span data-i18n="status_ok">âœ“ PoÅ‚Ä…czono z Home Assistant</span> ({{ entities|length }})
  </div>
{% else %}
  <div class="status-bar" style="background:#f8d7da;color:#721c24;">
    <span data-i18n="status_error">âš  Brak poÅ‚Ä…czenia z API. SprawdÅº token.</span>
  </div>
{% endif %}

<button type="button" class="btn btn-import" id="btn-toggle-import">
  <span data-i18n="btn_import_toggle">ðŸ“‚ Importuj / Edytuj Kod</span>
</button>

<div id="import-area" class="section import-box">
  <h4 style="margin-top:0" data-i18n="header_paste_code">Wklej kod pliku .dash tutaj:</h4>
  <textarea id="import-code" style="height:150px;background:#fff;color:#000;" placeholder="Wklej caÅ‚y plik .dash (np. dashboard1)"></textarea>
  <button type="button" class="btn btn-add" id="btn-import">
    <span data-i18n="btn_load_dash">Wczytaj Dashboard</span>
  </button>
</div>

<form id="main-form" onsubmit="prepareAndSubmit(event)">
  <input type="hidden" name="ui_language" id="ui_language" value="pl" />
  <input type="hidden" name="ui_theme" id="ui_theme" value="light" />
  <input type="hidden" name="layout_data_json" id="layout_data_json" />
  <input type="hidden" name="widgets_full_json" id="widgets_full_json" />
  <input type="hidden" name="generated_yaml_client" id="generated_yaml_client" />

  <div class="section">
    <div class="section-title" data-i18n="sec_settings">1. Ustawienia</div>
    <div class="flex-row">
      <div class="flex-col">
        <label data-i18n="dash_title">TytuÅ‚ Dashboardu (Nazwa pliku)</label>
        <input type="text" id="dash-title" value="dashboard" />
      </div>
    </div>
  </div>

  <div class="add-widget-box" id="widget-form-box">
    <h4 style="margin-top:0" id="form-header" data-i18n="sec_add">2. Dodaj / Edytuj Widget</h4>

    <div class="flex-row">
      <div class="flex-col">
        <label data-i18n="label_type">Typ Widgetu</label>
        <select id="new-widget-type" onchange="applySmartForForm(true)" onblur="applySmartForForm(true)">
          <!-- Options generated by JS -->
        </select>
      </div>

      <div class="flex-col" id="group-entity">
        <label data-i18n="label_entity">Wybierz EncjÄ™ (Home Assistant)</label>
        <input
          list="entities-list"
          id="new-entity-id"
          placeholder="np. light.salon"
          autocomplete="off"
          oninput="applySmartForForm(true)"
          onchange="applySmartForForm(true)"
        />
        <datalist id="entities-list">
          {% for entity in entities %}
          <option value="{{ entity.id }}">{{ entity.id }}</option>
          {% endfor %}
        </datalist>
      </div>

      <div class="flex-col hidden" id="group-nav">
        <label data-i18n="label_dashboard">Nazwa pliku dashboardu</label>
        <input id="new-dashboard-name" placeholder="np. dashboard2" oninput="applySmartForForm(true)" />
      </div>

      <div class="flex-col">
        <label data-i18n="label_name">TytuÅ‚ na ekranie</label>
        <input id="new-widget-name" placeholder="Automatycznie" />
      </div>
    </div>

    <div class="flex-row" style="margin-top:10px; align-items:flex-end;">
      <div class="flex-col" style="max-width:160px;">
        <label data-i18n="label_size">Rozmiar</label>
        <select id="new-widget-size">
          <option value="">DomyÅ›lny (2x1)</option>
          <option value="(1x1)">1x1</option>
          <option value="(2x1)">2x1</option>
          <option value="(2x2)">2x2</option>
          <option value="(3x1)">3x1</option>
          <option value="(1x2)">1x2</option>
          <option value="(3x2)">3x2</option>
        </select>
      </div>

      <div style="width:56px;">
        <label data-i18n="label_preview">PodglÄ…d</label>
        <div class="icon-preview-box">
          <i id="icon-preview-i" class="mdi mdi-help-circle-outline"></i>
        </div>
      </div>

      <div class="flex-col">
        <label data-i18n="label_icon">Ikona</label>
        <input id="new-widget-icon" list="icons-list" placeholder="np. mdi-lightbulb" oninput="updateIconPreview()" />
        <datalist id="icons-list"></datalist>
      </div>

      <div class="flex-col" style="display:flex; gap:10px; align-items:flex-end;">
        <button type="button" id="btn-action" class="btn btn-add"><span data-i18n="btn_add">+ DODAJ DO WIERSZA</span></button>
        <button type="button" id="btn-cancel" class="btn btn-cancel hidden"><span data-i18n="btn_cancel">Anuluj</span></button>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-title" data-i18n="sec_preview">3. PodglÄ…d Dashboardu (Kliknij, aby edytowaÄ‡)</div>
    <div id="rows-container" class="preview-area"></div>
    <button type="button" class="btn btn-row" id="btn-new-row"><span data-i18n="btn_new_row">+ Dodaj Nowy Wiersz</span></button>
  </div>

  <button type="submit" class="btn btn-primary"><span data-i18n="btn_generate">GENERUJ KOD .DASH</span></button>
</form>

<div class="section hidden" id="client-yaml-section">
  <h3 data-i18n="sec_code">TwÃ³j kod YAML (Klient):</h3>
  <div class="file-path-info">
    <strong data-i18n="info_step1">1. Zapisz kod w pliku:</strong>
    <code id="client-path-code">\\IP_HA\addon_configs\appdaemon\dashboards\dashboard2.dash</code>
    <strong data-i18n="info_step2">2. PodglÄ…d dashboardu:</strong>
    <a id="client-dashboard-link" class="dashboard-link-btn" target="_blank" href="http://IP_HA:5050/dashboard2">http://IP_HA:5050/dashboard2</a>
  </div>
  <textarea id="client-yaml-output" class="output" readonly></textarea>
</div>
